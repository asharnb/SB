{#
/**
* @file
* Default theme implementation to display the Session details page.
*
* Available variables:
* - session: Session node array
*   -  title: node title  -  {{ session.title.0.value }}
*   -  field_stauts: Status of session  -  {{ session.field_stauts.0.value }}
*   -  field_product: array of product ids, use like this to get count of total products - {{ ITEM.field_product|length }}
*   -  field_shoot_type: Type of session. -  {{ session.field_shoot_type.0.value }}
*   -  field_shoot_class: Class of session. - {{ session.field_shoot_class.0.value }}
*   -  created: Timestamp session created - {{ session.create.0.value|date("m/d/Y") }}
*  todo : check for missing values
*
* - grouped_concepts: array contain concept & count of its products
*   -  concept: Name of the concept  -  {{ ITEM.concept }}
*   -  product_count: Count of products under this concept -  {{ ITEM.product_count }}
*
* - unmapped_products: array contains all properties of unmapped products
*   -  title: Title/Identifier of unmapped product   -  {{ ITEM.title.0.value }}
*   -  field_images: To get count of image, use like -  {{ ITEM.field_images|length }}
*   -  field_state: Product status/stage.  -  {{ ITEM.field_state.0.value }}
*   -  created: Timestamp product created - {{ ITEM.create.0.value|date("m/d/Y") }}
*  todo : check for missing values
*
* - mapped_products: array contains all properties of mapped products
*   -  title: Title/Identifier of mapped product  -  {{ ITEM.title.0.value }}
*   -  field_images: To get count of image, use like -  {{ ITEM.field_images|length }}
*   -  field_state: Product status/stage. -  {{ ITEM.field_state.0.value }}
*   -  created: Timestamp product created - {{ ITEM.session.create.0.value|date("m/d/Y") }}
*   -  field_concept_name: Name of concept - {{ ITEM.field_concept_name.0.value }}
*   -  field_style_family: Name of style family - {{ ITEM.field_style_family.0.value }}
*   -  field_sku_id: SKU_ID value - {{ ITEM.field_sku_id.0.value }}
*  todo : check for missing values
*
* - session_users: array contains names of vm, photographer and stylist
*   - photographer: Name of photographer   -  {{ session_users.photographer }}
*   - stylist: Name of stylist - {{ session_users.stylist }}
*   - vm: Name of vm   -  {{ session_users.vm }}
*
* - total_images: Total no.of images in this session - {{ total_images }}
*
*
* @ingroup themeable
*/
#}


{#
/**
* @file
* Default theme implementation to display the Session details page.
*
* Available variables:
* - session: Session node array
*   -  session.title.0.value: node title
* todo yet to add
* @ingroup themeable
*/
#}


{{ attach_library('studiobridge/flot-charts') }}

{% if session.field_status.0.value == 'open' %}
{% set status_class = 'fa fa-play-circle text-success' %}
{% set status_class_text = 'text-success' %}
{% else %}
  {% set status_class = 'fa fa-stop-circle text-danger' %}
  {% set status_class_text = 'text-danger' %}
{% endif %}

{% if session.field_shoot_class.0.value == 'model_shoot' %}
{% set shoot_class = 'fa fa-user' %}
{% else %}
  {% set shoot_class = 'fa fa-cubes' %}
{% endif %}

{# calculate counts adjusted for drops #}
{% set adjusted_mapped = mapped_products|length - mapped_dropped_products|length %}
{% set adjusted_unmapped = unmapped_products|length - unmapped_dropped_products|length %}
{% set total_dropped = unmapped_dropped_products|length + mapped_dropped_products|length %}

{% set total_count = adjusted_mapped + adjusted_unmapped + total_dropped %}
<div class="row">
  <div class="col-sm-12 col-md-8">
    <h3>Session <span class="semi-bold">Details</span></h3>
  </div>
  <div class="col-sm-12 col-md-4 text-right">

  </div>
</div>

<div class="row p-t-10">
  <div class="col-lg-9">

    <div class="panel panel-default">

      <div class="row">
        <div class="col-lg-12" >
          <div class="panel-heading seperator m-b-sm">

            <div class="panel-controls">
              {% if session.field_status.0.value == 'open' %}
              <a data-id="{{total_count}}" id="import-products" class="btn btn-complete"><i class="fa fa-camera"></i> Import </a>
              <a href="/sbtest/live-shooting-page1" class="btn btn-warning "><i class="fa fa-pause"></i> Pause </a>
              <a data-id="{{ session.nid.0.value }}" class="btn btn-danger " id="close-session"><i class="fa fa-stop"></i> Close </a>


              {% elseif session.field_status.0.value == 'paused' %}
              <a href="/sbtest/live-shooting-page1" class="btn  btn-success"><i class="fa fa-play"></i> Resume </a></div>
              <a data-id="{{ session.nid.0.value }}" class="btn btn-danger " id="close-session"><i class="fa fa-stop"></i> Close </a>

              {% else %}
              <a href="#" class="btn  btn-complete "><i class="fa fa-file-excel-0o"></i> Export Shootlist </a>
              <a href="#" class="btn  btn-warning "><i class="fa fa-refresh"></i> Request to Reopen </a>
              {% endif %}
            </div>
          </div>
          <div class="col-sm-6">
            <table class="table">
              <tbody>
                <tr>
                  <td class="col-sm-6">
                    Shoot Date
                  </td>
                  <td class="col-sm-6">
                    <span class="semi-bold text-navy">{{ session.created.0.value|date("m-d-Y") }}</span>
                  </td>

                </tr>
                <tr>
                  <td class="col-sm-6">
                    Shoot Count
                  </td>
                  <td class="col-sm-6">
                    <span class="semi-bold text-navy">{{ adjusted_mapped + adjusted_unmapped }}</span>
                  </td>

                </tr>
                <tr>
                  <td class="col-sm-6">
                    Shoot Type
                  </td>
                  <td class="col-sm-6">
                    <span class="semi-bold text-navy">{{ session.field_shoot_type.0.value|title|replace({'_':' '}) }}</span>
                  </td>

                </tr>
                <tr>
                  <td class="col-sm-6">
                    Session Time
                  </td>
                  <td class="col-sm-6">
                    <span class="semi-bold text-navy">{{session_time}}</span>
                  </td>

                </tr>
              </tbody>
            </table>
          </div>
          <div class="col-sm-2">
            <div class="widget  text-center">

              <img src="/sbtest/{{directory}}/images/users/niranjan.jpg" class="img-circle circle-border " alt="profile">
              <h3 class="m-xs text-primary">Sajeewa</h3>
              <h5 class="font-bold no-margins">
                Photographer
              </h5>

            </div>
          </div>
          <div class="col-sm-2">
            <div class="widget text-center">

              <img src="/sbtest/{{directory}}/images/users/rebecca.jpg" class="img-circle circle-border" alt="profile">
              <h3 class="m-xs text-primary">Rebecca</h3>
              <h5 class="font-bold no-margins">
                Stylist
              </h5>

            </div>
          </div>
          <div class="col-sm-2">
            <div class="widget text-center">

              <img src="/sbtest/{{directory}}/images/users/cia.jpg" class="img-circle circle-border " alt="profile">
              <h3 class="m-xs text-primary">Cia</h3>
              <h5 class="font-bold no-margins">
                VM
              </h5>

            </div>
          </div>

          <!-- <dl class="dl-horizontal">
          <dt>Photographer:</dt>
          <dd>{{ session_users.photographer }}</dd>
          <dt>VM:</dt>
          <dd>{{ session_users.vm }}</dd>
          <dt>Stylist:</dt>
          <dd> {{ session_users.stylist }} </dd>
          <dt>Type:</dt>
          <dd> {{ session.field_shoot_type.0.value|title|replace({'_': ' '}) }} </dd>
        </dl> -->
      </div>

    </div>
    <div class="row m-t-sm">
      <div class="col-lg-12">
        <div class="panel blank-panel">
          <div class="panel-heading">
            <div class="panel-options">
              <ul class="nav nav-tabs nav-tabs-linetriangle">


                <li class="active"><a href="#tab-mapped" data-toggle="tab" aria-expanded="false">Mapped <span class="text-success semi-bold">({{ adjusted_mapped }})</span></a></li>
                <li class=""><a href="#tab-unmapped" data-toggle="tab" aria-expanded="false">Unmapped <span class="text-warning semi-bold">({{ adjusted_unmapped }})</span></a></li>
                <li class=""><a href="#tab-dropped" data-toggle="tab" aria-expanded="false">Drops <span class="text-danger semi-bold">({{total_dropped}})</span></a></li>
                <li class=""><a href="#tab-reports" data-toggle="tab" aria-expanded="false">Report(s)</a></li>

                {% if is_admin == true %}
                <li class=""><a href="#tab-analysis" data-toggle="tab" aria-expanded="true">Analysis</a></li>
                {% endif %}
                <
                <li class=""><a href="#tab-log" data-toggle="tab" aria-expanded="true">Log</a></li>


              </ul>
            </div>
          </div>
          <div class="panel-body">
            <div class="tab-content">
              <div class="tab-pane active" id="tab-mapped">
                <table id="dt_mapped" class="table table-responsive table-hover" width="100%">
                  <thead>
                    <tr>
                      <th>Concept</th>
                      <th>Style Family</th>
                      <th>Color Variant</th>
                      <th>State</th>
                      <th>QC Status</th>
                      <th>Raw Count</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for item in mapped_products %}

                    {% if item.field_draft.0.value == 0 %}

                    {% if item.field_images|length == 0 %}
                    {% set image_count_class = 'text-align-center bold text-danger' %}
                    {% elseif item.field_images|length >= 7 %}
                    {% set image_count_class = 'text-align-center bold text-warning' %}
                    {% else %}
                    {% set image_count_class = 'text-align-center bold text-success' %}
                    {% endif %}
                    <tr>
                      <td>
                        <img src="/sbtest/{{ directory }}/images/brands/brand_logo_{{ item.field_concept_name.0.value|lower }}.png"
                        height="20px"></td>
                        <td>{{ item.field_style_family.0.value }}</td>
                        <td>{{ item.title.0.value }}</td>
                        <td>
                          {% if item.nid.0.value in session.field_reshoot_product|json_encode() %}
                          <span class="text-warning semi-bold">Reshoot</span>
                          {% else %}
                          <span class="text-success semi-bold">New</span>
                          {% endif %}
                        </td>
                        <td><span class="label label-warning">Pending</span></td>
                        <td class="{{ image_count_class }}">{{ item.field_images|length }}</td>


                        <td class="text-align-center"><a target="_blank" class="btn btn-primary" href="/sbtest/view-product/{{item.nid.0.value }}">View</a></td>

                      </tr>
                      {% endif %}
                      {% endfor %}

                    </tbody>
                  </table>
                </div>

                <div class="tab-pane" id="tab-unmapped">

                  <table id="dt_unmapped" class="table table-responsive table-hover" width="100%">
                    <thead>
                      <tr>
                        <th>Concept</th>
                        <th>Identifier</th>
                        <th>State</th>
                        <th>Raw Count</th>
                        <th></th>
                      </tr>
                    </thead>
                    <tbody>

                      {% for item in unmapped_products %}
                      {% if item.field_draft.0.value == 0 %}

                      {% if item.field_images|length == 0 %}
                      {% set image_count_class = 'text-align-center bold text-danger' %}
                      {% elseif item.field_images|length >= 7 %}
                      {% set image_count_class = 'text-align-center bold text-warning' %}
                      {% else %}

                      {% set image_count_class = 'text-align-center bold text-success' %}
                      {% endif %}
                      <tr>
                        <td><img src="/sbtest/{{ directory }}/images/brands/brand_logo_.png"
                          height="20px"></td>
                          <td>{{ item.title.0.value }}</td>
                          <td>
                            {% if item.nid.0.value in session.field_reshoot_product|json_encode() %}
                            <span class="text-warning semi-bold">Reshoot</span>
                            {% else %}
                            <span class="text-success semi-bold">New</span>
                            {% endif %}
                          </td>
                          <td class="{{ image_count_class }}">{{ item.field_images|length }}</td>

                          <td class="text-align-center"><a target="_blank" class="btn btn-primary"  href="/sbtest/view-product/{{item.nid.0.value }}">View</a></td>

                        </tr>
                        {% endif %}
                        {% endfor %}

                      </tbody>
                    </table>
                  </div>

                  <div class="tab-pane" id="tab-dropped">
                    <table id="dt_drops" class="table table-responsive table-hover" width="100%">
                      <thead>
                        <tr>
                          <th>Concept</th>
                          <th>Style Family</th>
                          <th>Color Variant</th>
                          <th>State</th>
                          <th>Raw Count</th>
                          <th></th>
                          <th></th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for item in mapped_products %}

                        {% if item.field_draft.0.value == 1 %}

                        {% if item.field_images|length == 0 %}
                        {% set image_count_class = 'text-align-center bold text-danger' %}
                        {% elseif item.field_images|length >= 7 %}
                        {% set image_count_class = 'text-align-center bold text-warning' %}
                        {% else %}
                        {% set image_count_class = 'text-align-center bold text-success' %}
                        {% endif %}
                        <tr>
                          <td>
                            <img src="/sbtest/{{ directory }}/images/brands/brand_logo_{{ item.field_concept_name.0.value|lower }}.png"
                            height="20px"></td>
                            <td>{{ item.field_style_family.0.value }}</td>
                            <td>{{ item.title.0.value }}</td>
                            <td>
                              <span class="text-danger semi-bold">Dropped</span>

                            </td>
                            <td class="{{ image_count_class }}">{{ item.field_images|length }}</td>

                            <td class="text-align-center"><a target="_blank" class="btn btn-primary" href="/sbtest/view-product/{{item.nid.0.value }}">View</a></td>
                            <td class="text-align-center"><a target="_blank" class="btn btn-success" href="/sbtest/view-product/{{item.nid.0.value }}">Undo</a></td>

                          </tr>
                          {% endif %}
                          {% endfor %}

                          {% for item in unmapped_products %}

                          {% if item.field_draft.0.value == 1 %}

                          {% if item.field_images|length == 0 %}
                          {% set image_count_class = 'text-align-center bold text-danger' %}
                          {% elseif item.field_images|length >= 7 %}
                          {% set image_count_class = 'text-align-center bold text-warning' %}
                          {% else %}
                          {% set image_count_class = 'text-align-center bold text-success' %}
                          {% endif %}
                          <tr>
                            <td>
                              <img src="/sbtest/{{ directory }}/images/brands/brand_logo_{{ item.field_concept_name.0.value|lower }}.png"
                              height="20px"></td>
                              <td>{{ item.field_style_family.0.value }}</td>
                              <td>{{ item.title.0.value }}</td>
                              <td>
                                <span class="text-danger semi-bold">Dropped</span>

                              </td>
                              <td class="{{ image_count_class }}">{{ item.field_images|length }}</td>

                              <td class="text-align-center"><a target="_blank" class="btn btn-primary" href="/sbtest/view-product/{{item.nid.0.value }}">View</a></td>
                              <td class="text-align-center"><a target="_blank" class="btn btn-success" href="/sbtest/view-product/{{item.nid.0.value }}">Undo</a></td>

                            </tr>
                            {% endif %}
                            {% endfor %}
                          </tbody>
                        </table>
                      </div>

                      <div class="tab-pane" id="tab-reports">
                        <div class="attachment">
                          <div class="file-box">
                            <div class="file">
                              <a href="#">
                                <span class="corner"></span>
                                <div class="icon">
                                  <i class="fa fa-file-excel-o text-success"></i>
                                </div>
                              </a>
                              <div class="file-name">
                                <a target="_blank">Shoot List</a>
                                <br>
                              </div>
                            </div></div>
                            <div class="file-box">
                              <div class="file">
                                <a href="#">
                                  <span class="corner"></span>

                                  <div class="icon">
                                    <i class="fa fa-file-pdf-o text-danger"></i>
                                  </div>
                                  <div class="file-name">
                                    Analysis
                                    <br>
                                  </div>
                                </a>
                              </div>

                            </div>
                            <div class="clearfix"></div>
                          </div>


                        </div>


                        <div class="tab-pane" id="tab-analysis">


                          <div class="col-sm-height col-bottom ">
                            <div class="flot-chart">
                                <div class="flot-chart-content" id="flot-analysis-chart" style="height:300px;"></div>
                            </div>
                          </div>

                        </div>




                      </div>


                    </div>
                  </div>
                </div>

              </div>

            </div>
          </div>

          <div class="col-lg-3">

            <div class="sidebard-panel" style="min-height: 100%;">

              <div id="widgettile">
                <div class="widget blue-bg text-center">
                  <div class="m-b-s">

                    <div class="row ">
                      <div class="col-sm-6">
                        <div class="timeline-day-number pull-right text-white">{{ session.nid.0.value }}</div>
                      </div>
                      <div class="col-sm-6 text-left m-t-sm">
                        <div class="timeline-day {{status_class_text}}"><span><i class="{{ status_class }}"></i>    {{ session.field_status.0.value|title}} </span></div>
                        <div class="timeline-month c-gray text-white"><span><i class="{{ shoot_class }}"></i>    {{ session.field_shoot_class.0.value|title|replace({'_': ' '}) }}</span></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <hr class="simple">
              <div class="m-t-s">
                <h3>
                  <small>Stage:</small>
                  <span id="textstage">Shoot</span></h3>
                  <div class="progress progress-striped active">
                    <div style="width: 25%" class="progress-bar progress-bar-complete"></div>
                  </div>
                </div>

                {% for item in grouped_concepts %}

                <div class="company-stat-boxes">
                  <div data-index="" class="company-stat-box mb-10  active padding-10 bg-master-lightest">



                    <p class="company-name pull-left text-uppercase bold no-margin">
                      <img src="/sbtest/{{ directory }}/images/brands/brand_logo_{{ item.concept|lower }}.png"
                      height="15px">
                      <div class="pull-right">
                        <span class=" label label-primary p-t-5 m-l-5 p-b-5 inline fs-12">{{ item.product_count }}
                        </span>

                      </div>

                    </p>

                    <div class="clearfix"></div>



                  </div>

                </div>
                {% endfor %}
                {% if unmapped_products|length > 0 %}
                <div class="company-stat-boxes">
                  <div data-index="" class="company-stat-box mb-10  active padding-10 bg-master-lightest">



                    <p class="company-name pull-left text-uppercase bold no-margin">
                      <img src="/sbtest/{{ directory }}/images/brands/brand_logo_.png"
                      height="15px">
                      <div class="pull-right">
                        <span class=" label label-danger p-t-5 m-l-5 p-b-5 inline fs-12">{{ unmapped_products|length }}
                        </span>

                      </div>

                    </p>

                    <div class="clearfix"></div>



                  </div>

                </div>
                {% endif %}
              </div>

            </div>
          </div>


          {#-------------------Analysis Chart---------------------------#}
          {% if period_chart|length > 0 %}
          <script type="text/javascript">

          // var data2 = [
          //     [gd(2012, 1, 1), 7], [gd(2012, 1, 2), 6], [gd(2012, 1, 3), 4], [gd(2012, 1, 4), 8],
          //     [gd(2012, 1, 5), 9], [gd(2012, 1, 6), 7], [gd(2012, 1, 7), 5]
          // ];
          //
          // var data3 = [
          //     [gd(2012, 1, 1), 10], [gd(2012, 1, 2), 12], [gd(2012, 1, 3), 24], [gd(2012, 1, 4), 9],
          //     [gd(2012, 1, 5), 14], [gd(2012, 1, 6), 6], [gd(2012, 1, 7), 20]
          // ];

var data3 = [
          {% for chart in period_chart %}


            [{{chart.label}}, "{{chart.value}}"]
          ,
            {% endfor %}
          ];

console.log(data3);


          var dataset = [
              {
                  label: "This Week",
                  data: data3,

                  lines: {
                      show: false,
                      fill: true
                  },
                  splines: {
                      show: true,
                      tension: 0.4,
                      lineWidth: 1,
                      fill: 0.4
                  },
                  points: {
                      radius: 0,
                      show: true
                  },
                  shadowSize: 2

              }
          ];


          var options = {
              colors: ["#1ab394", "#1C84C6"],
              xaxis: {
                ticks: 0
              },
              yaxes: [{
                ticks: 0
              },{
                ticks: 0
              }
              ],
              legend: {
                  noColumns: 1,
                  labelBoxBorderColor: "#000000",
                  position: "nw"
              },
              grid: {
                  hoverable: false,
                  borderWidth: 0
              },
              tooltip: true
          };

          function gd(year, month, day) {
              return new Date(year, month - 1, day).getTime();
          }

          var previousPoint = null, previousLabel = null;

          //$.plot($("#flot-analysis-chart"), dataset, options);
          console.log(dataset);
          </script>
          {% endif %}
